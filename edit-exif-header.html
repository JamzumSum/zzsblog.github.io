<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Edit EXIF header using exiv2</title><meta name="description" content="How to edit exif header information in C++ using exiv2"><meta name="generator" content="Publii Open-Source CMS for Static Site"><meta name="theme-color" content="#17181E" media="(prefers-color-scheme: dark)"><meta name="theme-color" content="#7A918B" media="(prefers-color-scheme: light)"><meta name="msapplication-navbutton-color" content="#7A918B"><meta name="apple-mobile-web-app-status-bar-style" content="#7A918B"><link rel="canonical" href="https://zzsblog.top/edit-exif-header.html"><link rel="amphtml" href="https://zzsblog.top/amp/edit-exif-header.html"><link rel="alternate" type="application/atom+xml" href="https://zzsblog.top/feed.xml"><link rel="alternate" type="application/json" href="https://zzsblog.top/feed.json"><meta property="og:title" content="如何修改图像的 EXIF 头信息？"><meta property="og:image" content="https://zzsblog.top/media/posts/3/download2"><meta property="og:image:width" content="1920"><meta property="og:image:height" content="1280"><meta property="og:site_name" content="鸽园"><meta property="og:description" content="How to edit exif header information in C++ using exiv2"><meta property="og:url" content="https://zzsblog.top/edit-exif-header.html"><meta property="og:type" content="article"><link rel="shortcut icon" href="https://zzsblog.top/media/website/favicon.png" type="image/png"><link rel="stylesheet" href="https://zzsblog.top/assets/css/style.css?v=98be4ef925dfbb6421fddbe6531eda36"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://zzsblog.top/edit-exif-header.html"},"headline":"如何修改图像的 EXIF 头信息？","datePublished":"2022-07-31T19:48","dateModified":"2022-08-01T20:17","image":{"@type":"ImageObject","url":"https://zzsblog.top/media/posts/3/download2","height":false,"width":false},"description":"How to edit exif header information in C++ using exiv2","author":{"@type":"Person","name":"JamzumSum","url":"https://zzsblog.top/author/jamzumsum/"},"publisher":{"@type":"Organization","name":"JamzumSum","logo":{"@type":"ImageObject","url":"https://zzsblog.top/media/website/favicon-2.png","height":480,"width":480}}}</script><script>window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      processEscapes: true,
    }
  }</script><script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><link href="https://cdn.jsdelivr.net/npm/prismjs@v1.x/themes/prism.css" rel="stylesheet"></head><body><script src="https://cdn.jsdelivr.net/npm/prismjs@v1.x/components/prism-core.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@v1.x/plugins/autoloader/prism-autoloader.min.js"></script><div class="container"><header class="header" id="js-header"><a href="https://zzsblog.top/" class="logo"><img src="https://zzsblog.top/media/website/favicon-2.png" alt="鸽园" width="480" height="480"></a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://zzsblog.top/" title="Goto Homepage" target="_self">Home</a></li><li class="has-submenu"><a href="https://zzsblog.top/tag/" title="Categories" target="_self" aria-haspopup="true">Categories</a><ul class="navbar__submenu level-2" aria-hidden="true"><li class="has-submenu"><a href="https://zzsblog.top/tag/coding/" title="Coding" target="_self" aria-haspopup="true">Coding</a><ul class="navbar__submenu level-3" aria-hidden="true"><li class="has-submenu"><a href="https://zzsblog.top/tag/python/" title="Python" target="_self" aria-haspopup="true">Python</a><ul class="navbar__submenu level-4" aria-hidden="true"><li><a href="https://zzsblog.top/tag/pytorch/" title="torch" target="_self">PyTorch</a></li></ul></li></ul></li><li><a href="https://zzsblog.top/tag/qzone2tg/" title="Collections of Qzone2TG posts" target="_self">Qzone2TG</a></li></ul></li><li><a href="https://zzsblog.top/about.html" title="About me">About</a></li><li><a href="https://github.com/JamzumSum/zzsblog" title="Goto blog repo on GitHub" target="_blank">GitHub</a></li><li><a href="https://zzsblog.top/merger.html" title="Buy me a cup of coffee☕" target="_self">Donate</a></li></ul></nav><div class="search"><div class="search__overlay js-search-overlay"></div><button class="search__btn js-search-btn" aria-label="Search"><svg role="presentation" focusable="false" height="15" width="15"><use xlink:href="https://zzsblog.top/assets/svg/svg-map.svg#search"/></svg></button></div></header><main><article class="post wrapper"><header class="hero"><p class="post__meta">Published on <time datetime="2022-07-31T19:48">22/07/31</time></p><h1 class="post__title">如何修改图像的 EXIF 头信息？</h1></header><figure class="post__featured-image post__image--wide"><img src="https://zzsblog.top/media/posts/3/download2" loading="eager" height="1280" width="1920" alt="white wooden block table"><figcaption>Structure @estherrj</figcaption></figure><div class="post__entry"><p>写了一个下载必应美图的程序. 然而还没完, 我一直想改一下</p><figure class="post__image"><img decoding="async" loading="lazy" src="https://zzsblog.top/media/posts/3/example.png" alt="这个东西" width="543" height="771" sizes="(max-width: 1024px) 100vw, 1024px" srcset="https://zzsblog.top/media/posts/3/responsive/example-xs.png 300w, https://zzsblog.top/media/posts/3/responsive/example-sm.png 480w, https://zzsblog.top/media/posts/3/responsive/example-md.png 768w, https://zzsblog.top/media/posts/3/responsive/example-lg.png 1024w"></figure>…当时注意力就在这些什么”详细信息”啊, “属性”之类的上面, 搜啊搜啊, 也没找到什么办法…<p></p><p>今天早晨拿两个文件做对比试验, 于是发现修改了详细信息的文件(JPEG)会多出来一个”头部”, 一番搜索知道了这个叫<code>EXIF</code>头信息, 于是就有了下面这篇文章.</p><h2 id="编译exiv2">编译<a href="https://www.exiv2.org/">Exiv2</a></h2><blockquote><p>我就不跟你们说我从哪找来这么个玩意儿的事了, 反正就是百度上搜两三个读写EXIF的库, 看看哪个好点…</p></blockquote><p>从Exiv2的官网上下载了<code>2017msvc64</code>的build包, 加载到自己的项目里就炸了. 原因很奇怪, 说是没有<code>std::auto_ptr</code>这种类型. 当年看<em>Effective C++</em> 的时候见过这个类型, 肿么就没有了捏? 网上一查知道, <code>auto_ptr</code>这种类型在C++11的时候就已经废弃了, C++17时把它移除了. C++语言标准一直都是17, 所以没有这个类型.</p><p>我当时一寻思, 我是不太乐意改语言标准的, 因为我比较喜欢尝试新特性…所以就试着自己编译一下.</p><h3 id="git-clone">git clone</h3><p>这步你们都懂罢, 拉一份最新的源码下来, 仓库在官网下载页里有, 我就不贴命令了</p><h3 id="用vs-cmake编译exiv2">用VS Cmake编译Exiv2</h3><blockquote><p>我自己是根本不会用什么cmake什么什么的, 但是我知道VS可以帮我干这个. 以前我编译过<code>tesseract</code>, 那时候只知道cmake这么个名 <del>(其实现在也一样)</del>…</p></blockquote><p>在exiv2的文件夹里<code>shift+右键</code>, 点击<code>用Visual Studio打开</code>, 如果你没有就用正常办法…打开之后VS会自动建立cmake缓存, 可以看<code>输出</code>选项卡看看VS在做什么.</p><p>然后呢, 我这是报了个错, 说是找不到<code>EXPAT</code>, 我百度了一下都是英文, 索性也不看了, 就用<code>vcpkg</code>装了一个…</p><pre><code class="language-{code-block}">vcpkg install expat:x64-windows
</code></pre><p>注意我一直是x64平台编译, 所以只安装64位的, 如果你也用x86, 那还要安装x86版本的.</p><p>这里给微软打个广告, <a href="https://docs.microsoft.com/zh-cn/cpp/build/vcpkg?view=vs-2017">vcpkg</a>虽然平时的项目里不知道为啥不好使, 但是在cmake的时候真的是帮我这种小白好大忙, 缺什么包敲个命令就好了, 不用我自己下载编译什么的.</p><p>依赖问题解决, cmake缓存正常, 这时候我去src里面找源码, 发现源码里面居然一个<code>auto_ptr</code>都没有??? 可能是从git上拉下来的比较新罢, 我也不知道是怎么回事(不敢相信.jpg).</p><p>下一步, 告诉编译器我要C++17标准的, 这个找了半天, 我下面写一段代码, <strong>不保证一定是对的</strong>, 我只能说我编译出来了, 而且用起来没问题.</p><pre><code class="language-{code-block}">include(CheckCXXCompilerFlag)
CHECK_CXX_COMPILER_FLAG(&quot;/std:c++17&quot; _cpp_17_flag_supported)
if (_cpp_17_flag_supported)
    add_compile_options(&quot;/std:c++17&quot;)
endif()
</code></pre><p>把上面这段代码附加到<code>Cmakelists.txt</code>末尾, 全部生成, 一切正常. 安装exiv2, 完毕.</p><p>这些做完了之后不要关VS, 现在只是编译了<code>x64-Debug</code>版本的, 到配置管理器里添加一个Release版本的再来一次, 省得发布的时候再折腾.</p><h2 id="使用exiv2">使用Exiv2</h2><blockquote><p>本来网上有几篇写这个的, 但我为什么还要写一遍呢? 因为网上的(至少是我看见的)都是读EXIF信息, 没有写入的, 为此我绕了个弯子, 所以发出来给大伙瞧瞧写入照比读取要多了什么(你能猜到罢?)</p></blockquote><pre><code class="language-cpp">void BingPicker::addCopyRight(const QString&amp; filepath, const QString&amp; copyright) {
    using namespace Exiv2;
    //这改成unique_ptr了, 发现没?
    Image::UniquePtr image = ImageFactory::open(filepath.toStdString());
    assert(image.get());

    image-&gt;readMetadata();
    ExifData ed = image-&gt;exifData();
    ed[&quot;Exif.Image.Copyright&quot;] = copyright.toStdString();
    image-&gt;setExifData(ed);         //note this
    image-&gt;writeMetadata();
}
</code></pre><p>额, 网上没有写入的例子, 我是在官网文档给的例子里找了一阵子把下面两句补上的. 你猜得没错, 写入是要保存的, <code>setExifData</code>和<code>writeMetadata</code>就是写入的关键, 之前只顾着找网上现成的抄, 运行了发现根本没写进去, 为此一顿好找…</p><p>上面<code>ExifData::operator[]</code>返回的是一个引用, 如果没有这个键值会直接新建一个(参考map的<code>operator[]</code>), 用法很直觉, 不用担心段错误.</p><h2 id="结尾">结尾</h2><p>我把浏览器关了, 就不找之前看过啥教程了..这把写的比较详细应该…感谢StackOverflow上提问的老哥, 我在回答里翻出来了cmake切换C++语言标准的代码…感谢网上两篇<code>exiv2</code>读EXIF的教程</p><p>照例感谢一万篇教程的作者们.</p><p>源码-&gt; <a href="https://github.com/JamzumSum/BingPicker">GitHub</a>, 还有Release版本可供下载哦(滑稽)</p></div><footer class="post__footer"><div class="post__footer__col"><ul class="post__tag"><li><a href="https://zzsblog.top/tag/cxx/">C++</a></li><li><a href="https://zzsblog.top/tag/coding/">Coding</a></li></ul><div class="post__share"><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fzzsblog.top%2Fedit-exif-header.html" class="js-share facebook" aria-label="Share with Facebook" rel="nofollow noopener noreferrer"><svg class="icon"><use xlink:href="https://zzsblog.top/assets/svg/svg-map.svg#facebook"/></svg> </a><a href="https://pinterest.com/pin/create/button/?url=https%3A%2F%2Fzzsblog.top%2Fedit-exif-header.html&amp;media=https%3A%2F%2Fzzsblog.top%2Fmedia%2Fposts%2F3%2Fdownload2&amp;description=%E5%A6%82%E4%BD%95%E4%BF%AE%E6%94%B9%E5%9B%BE%E5%83%8F%E7%9A%84%20EXIF%20%E5%A4%B4%E4%BF%A1%E6%81%AF%EF%BC%9F" class="js-share pinterest" aria-label="[MISSING TRANSLATION] Share with Pinterest" rel="nofollow noopener noreferrer"><svg class="icon"><use xlink:href="https://zzsblog.top/assets/svg/svg-map.svg#pinterest"/></svg> </a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fzzsblog.top%2Fedit-exif-header.html" class="js-share linkedin" aria-label="Share with LinkedIn" rel="nofollow noopener noreferrer"><svg class="icon"><use xlink:href="https://zzsblog.top/assets/svg/svg-map.svg#linkedin"/></svg></a></div></div></footer></article><div class="comments-area wrapper"></div><div class="banner banner--after-post"><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"></a><br>本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。</div></main><footer class="footer"><div class="footer__copyright">Powered by Publii, Copyright (c) 2022 JamzumSum</div></footer></div><script defer="defer" src="https://zzsblog.top/assets/js/scripts.min.js?v=620157e86bfc246cfef480b1b4aadb48"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.navbar'};</script><script>/*<![CDATA[*/var images=document.querySelectorAll("img[loading]");for(var i=0;i<images.length;i++){if(images[i].complete){images[i].classList.add("is-loaded")}else{images[i].addEventListener("load",function(){this.classList.add("is-loaded")},false)}};/*]]>*/</script></body></html>